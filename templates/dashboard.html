{% extends "base.html" %}
{% block content %}
<div class="text-center mb-4">
    <h2 class="fw-bold text-primary">ðŸ“Š Chama Dashboard</h2>
    <p class="text-muted">Overview of contributions and loans</p>
</div>

<!-- Contributions Chart -->
<h5 class="mb-3">Member Contributions</h5>
<canvas id="contributionChart" class="mb-5"></canvas>

<!-- Loan Summary -->
<h5 class="mb-3">Loan Summary</h5>
<div class="table-responsive">
    <table class="table table-striped table-bordered text-center">
        <thead class="table-dark">
            <tr>
                <th>Member</th>
                <th>Principal</th>
                <th>Total Due</th>
                <th>Repaid</th>
                <th>Balance</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for loan in loans %}
            <tr>
                <td>{{ loan[0] }}</td>
                <td>KES {{ loan[1] }}</td>
                <td>KES {{ loan[2] }}</td>
                <td>KES {{ loan[3] }}</td>
                <td>KES {{ loan[4] }}</td>
                <td>
                    {% if loan[4] <= 0 %}
                        <span class="badge bg-success">Completed</span>
                    {% else %}
                        <span class="badge bg-danger">Ongoing</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('contributionChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: {{ chart_labels | tojson }},
            datasets: [{
                data: {{ chart_data | tojson }},
                backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1', '#20c997']
            }]
        }
    });
</script>
{% endblock %}
